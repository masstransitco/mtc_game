<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D Sprite Driving Game</title>
  <style>
    body { margin: 0; overflow: hidden; background-color: #000; }
    #loadingText {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-size: 24px;
      color: white;
    }
    #score {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      color: white;
    }
    #highScore {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: white;
    }
    #instructions {
      position: absolute;
      bottom: 60px;
      width: 100%;
      text-align: center;
      font-size: 18px;
      color: white;
    }
    #gameOver {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
    }
    #restartButton {
      margin-top: 20px;
      font-size: 18px;
      padding: 10px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="loadingText">Loading... Please wait</div>
  <div id="highScore">High Score: 0</div>
  <div id="score">Score: 0</div>
  <div id="instructions">Use Arrow Keys or Touch to Move</div>
  <div id="gameOver">
    <h1>Game Over!</h1>
    <p>Your Score: <span id="finalScore"></span></p>
    <button id="restartButton">Play Again</button>
  </div>
  <script>
    let canvas, ctx;
    let player, obstacles = [], powerUps = [];
    let keys = {};
    let score = 0, highScore = 0;
    let gameOver = false;
    let obstacleSpawnInterval = 2000;
    let lastObstacleSpawn = 0;
    let speed = 2;
    let lastTime = 0;
    let playerImage, obstacleImages = [], powerUpImage, bgImage;
    let bgY = 0;
    let isInvincible = false;
    let invincibleTimer = 0;

    function init() {
      canvas = document.createElement('canvas');
      ctx = canvas.getContext('2d');
      document.body.appendChild(canvas);
      resizeCanvas();

      // Load images
      let imagesLoaded = 0;
      let totalImages = 5;

      playerImage = new Image();
      playerImage.src = 'https://rz8ua7dqyi1bjfre.public.blob.vercel-storage.com/mtc-iiAB4M5JhM5wbYFOv3745uPs7C73Cq.glb';
      playerImage.onload = () => { imagesLoaded++; checkImagesLoaded(); };

      obstacleImages[0] = new Image();
      obstacleImages[0].src = 'obstacle_car1.png';
      obstacleImages[0].onload = () => { imagesLoaded++; checkImagesLoaded(); };

      obstacleImages[1] = new Image();
      obstacleImages[1].src = 'obstacle_car2.png';
      obstacleImages[1].onload = () => { imagesLoaded++; checkImagesLoaded(); };

      powerUpImage = new Image();
      powerUpImage.src = 'power_up.png';
      powerUpImage.onload = () => { imagesLoaded++; checkImagesLoaded(); };

      bgImage = new Image();
      bgImage.src = 'road_bg.png';
      bgImage.onload = () => { imagesLoaded++; checkImagesLoaded(); };

      function checkImagesLoaded() {
        if (imagesLoaded === totalImages) {
          startGame();
        }
      }
    }

    function startGame() {
      document.getElementById('loadingText').style.display = 'none';
      document.getElementById('instructions').style.display = 'block';

      player = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 100,
        width: 50,
        height: 100,
        speed: 5
      };

      window.addEventListener('keydown', keyDown);
      window.addEventListener('keyup', keyUp);
      window.addEventListener('touchstart', touchStart);
      window.addEventListener('touchmove', touchMove);
      window.addEventListener('touchend', touchEnd);
      window.addEventListener('resize', resizeCanvas);

      requestAnimationFrame(gameLoop);
    }

    function gameLoop(timestamp) {
      if (gameOver) return;

      let deltaTime = timestamp - lastTime;
      lastTime = timestamp;

      update(deltaTime);
      render();

      requestAnimationFrame(gameLoop);
    }

    function update(deltaTime) {
      // Background scrolling
      bgY += speed;
      if (bgY >= canvas.height) bgY = 0;

      // Player movement
      if (keys['ArrowLeft'] || keys['a']) {
        player.x -= player.speed;
        if (player.x < 0) player.x = 0;
      }
      if (keys['ArrowRight'] || keys['d']) {
        player.x += player.speed;
        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
      }

      // Spawn obstacles
      if (timestamp - lastObstacleSpawn > obstacleSpawnInterval) {
        spawnObstacle();
        lastObstacleSpawn = timestamp;
        // Increase speed and difficulty over time
        speed += 0.1;
        if (obstacleSpawnInterval > 800) obstacleSpawnInterval -= 50;
      }

      // Update obstacles
      obstacles.forEach((obstacle, index) => {
        obstacle.y += speed;
        if (obstacle.y > canvas.height) {
          obstacles.splice(index, 1);
          score++;
          updateScore();
        }
        // Check collision
        if (isColliding(player, obstacle) && !isInvincible) {
          endGame();
        }
      });

      // Update power-ups
      powerUps.forEach((powerUp, index) => {
        powerUp.y += speed;
        if (powerUp.y > canvas.height) {
          powerUps.splice(index, 1);
        }
        // Check collision
        if (isColliding(player, powerUp)) {
          powerUps.splice(index, 1);
          activateInvincibility();
        }
      });

      // Invincibility timer
      if (isInvincible) {
        invincibleTimer -= deltaTime;
        if (invincibleTimer <= 0) {
          isInvincible = false;
        }
      }
    }

    function render() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw background
      ctx.drawImage(bgImage, 0, bgY - canvas.height, canvas.width, canvas.height);
      ctx.drawImage(bgImage, 0, bgY, canvas.width, canvas.height);

      // Draw player
      if (isInvincible) {
        ctx.globalAlpha = 0.5;
      }
      ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);
      ctx.globalAlpha = 1;

      // Draw obstacles
      obstacles.forEach(obstacle => {
        ctx.drawImage(obstacle.image, obstacle.x, obstacle.y, obstacle.width, obstacle.height);
      });

      // Draw power-ups
      powerUps.forEach(powerUp => {
        ctx.drawImage(powerUpImage, powerUp.x, powerUp.y, powerUp.width, powerUp.height);
      });
    }

    function spawnObstacle() {
      let obstacleWidth = 50;
      let obstacleHeight = 100;
      let obstacleX = Math.random() * (canvas.width - obstacleWidth);
      let obstacleY = -obstacleHeight;
      let obstacleImage = obstacleImages[Math.floor(Math.random() * obstacleImages.length)];

      obstacles.push({
        x: obstacleX,
        y: obstacleY,
        width: obstacleWidth,
        height: obstacleHeight,
        image: obstacleImage
      });

      // Randomly spawn power-ups
      if (Math.random() < 0.1) {
        powerUps.push({
          x: Math.random() * (canvas.width - 30),
          y: -30,
          width: 30,
          height: 30
        });
      }
    }

    function activateInvincibility() {
      isInvincible = true;
      invincibleTimer = 5000; // 5 seconds of invincibility
    }

    function isColliding(rect1, rect2) {
      return (
        rect1.x < rect2.x + rect2.width &&
        rect1.x + rect1.width > rect2.x &&
        rect1.y < rect2.y + rect2.height &&
        rect1.y + rect1.height > rect2.y
      );
    }

    function endGame() {
      gameOver = true;
      document.getElementById('finalScore').textContent = score;
      document.getElementById('gameOver').style.display = 'block';
      document.getElementById('instructions').style.display = 'none';
      if (score > highScore) {
        highScore = score;
        updateHighScore();
      }
    }

    function updateScore() {
      document.getElementById('score').textContent = `Score: ${score}`;
    }

    function updateHighScore() {
      document.getElementById('highScore').textContent = `High Score: ${highScore}`;
    }

    function keyDown(e) {
      keys[e.key] = true;
    }

    function keyUp(e) {
      keys[e.key] = false;
    }

    function touchStart(e) {
      let touchX = e.touches[0].clientX;
      if (touchX < canvas.width / 2) {
        keys['ArrowLeft'] = true;
      } else {
        keys['ArrowRight'] = true;
      }
    }

    function touchMove(e) {
      let touchX = e.touches[0].clientX;
      if (touchX < canvas.width / 2) {
        keys['ArrowLeft'] = true;
        keys['ArrowRight'] = false;
      } else {
        keys['ArrowRight'] = true;
        keys['ArrowLeft'] = false;
      }
    }

    function touchEnd(e) {
      keys['ArrowLeft'] = false;
      keys['ArrowRight'] = false;
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      if (player) {
        player.x = canvas.width / 2 - player.width / 2;
        player.y = canvas.height - player.height - 20;
      }
    }

    document.getElementById('restartButton').addEventListener('click', () => {
      // Reset game state
      gameOver = false;
      score = 0;
      speed = 2;
      obstacleSpawnInterval = 2000;
      obstacles = [];
      powerUps = [];
      lastObstacleSpawn = 0;
      isInvincible = false;
      invincibleTimer = 0;
      updateScore();
      document.getElementById('gameOver').style.display = 'none';
      document.getElementById('instructions').style.display = 'block';
      lastTime = performance.now();
      requestAnimationFrame(gameLoop);
    });

    // Start the game
    init();
  </script>
</body>
</html>
